<!DOCTYPE html>
<head>
	<title>1Community</title>
   <!-- Materializecss compiled and minified CSS -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
   <!--Import Google Icon Font-->
   <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
   <link href="https://cdn.jsdelivr.net/npm/materialize-stepper@2.1.4/materialize-stepper.css" rel="stylesheet">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
   <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
   <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
   <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200&display=swap" rel="stylesheet">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/5.7.3/firebase.js"></script>
   <!-- jQueryValidation Plugin -->
   <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.15.0/jquery.validate.min.js"></script>

</head>
<body style="font-family: 'Manrope', sans-serif;">
	<!--Navbar-->
   <nav class="lighten-2 nav-extended">
      <div class="nav-wrapper" style="height: 100px; background-color: #F2AF58">
         <a href="index.html" class="brand-logo center"><img src="logo.png" style="width: 90px; margin-top: 4%"></a>
      </div>
   </nav>

   <div class="container" style="margin-top: 5%; left: 6%; right: 6%; width: 88%">
      <form>
         <ul class="stepper parallel horizontal">

            <li class="step active">
               <div class="step-title waves-effect waves-dark">Step 1</div>
               <div class="step-content">
                  <div class="row">
                     <div class='form-field col s12'>
                        <p style="font-size: 24px">Campaign Title</p>
                        <div style="line-height: 2; font-size: 13px">
	                        <span style="margin-left: 3%; color: red">1) Be inspired by other successful campaign titles; </span><span>the "Braden's Hearing Aid Awareness" campaign is one that is worth looking into</span><br>
	                        <span style="margin-left: 3%; color: red">2) Make the title specific to your cause. </span><span>This is something that your description will base itself off of later on</span><br>
	                        <span style="margin-left: 3%; color: red;">3) Select a simple name that strikes emotionally; </span><span>something like "A Better Home for Danny", would, for example, be much better than "Help Me Afford A Two-Storied Retirement Housing" because more people <span style="margin-left: 3%">will relate to your issue</span></span><br>
                    	</div>

                        <div class="input-field col s12">
                           <input type="text" name="textfield" class="required validate" id="title"/>
                           <label for="textfield">Your Best Title!</label>
                        </div>
                     </div>
                  </div>
                  <div class="step-actions">
                     <button class="waves-effect waves-dark btn next-step">CONTINUE</button>
                     <button class="waves-effect waves-dark btn-flat previous-step">BACK</button>
                  </div>
               </div>
            </li>

            <li class="step">
               <div class="step-title waves-effect waves-dark">Step 2</div>
               <div class="step-content">
                  <div class="row">
                     <div class='form-field col s12'>
                     	<div style="float: left">
	                        <p style="font-size: 24px">Location</p>
	                        <div style="font-size: 12px">What's your current/closest city <br>(if public location, what's you address)?</div>
                    	</div>
                        <div class="input-field col" style="float: left; margin-top: 3%; margin-left: 6%; width: 75%">
                           <input type="text" name="textfield" class="required validate" id="location"/>
                           <label for="textfield">e.g Toronto, New York</label>
                        </div>
                     </div>
                  </div>
                  <div class="row">
                     <div class='form-field col s12'>
                     	<div style="float: left">
	                        <p style="font-size: 24px">Fundraiser Link</p>
	                        <div style="font-size: 12px">Where's your fundraiser hosted?</div>
                    	</div>
                        <div class="input-field col" style="float: left; margin-top: 3%; margin-left: 6.4%; width: 75%">
                           <input type="text" name="textfield" class="required validate" id="link"/>
                           <label for="textfield">e.g. GoFundMe, Fundly, etc</label>
                        </div>
                     </div>
                  </div>
                  <div class="step-actions">
                     <button class="waves-effect waves-dark btn next-step" onclick="getTitle()">CONTINUE</button>
                     <button class="waves-effect waves-dark btn-flat previous-step">BACK</button>
                  </div>
                  <div class="row">
                     <div class='form-field col s12'>
                     	<div style="float: left">
	                        <p style="font-size: 24px">Image</p>
	                        <div style="font-size: 12px">What sums up your campaign in an image?</div>
                    	</div>
                        <form action="#">
						    <div class="file-field input-field" style="margin-left: 21.3%">
						      <div class="btn" style="height: 40px">
						        <span>Upload</span>
						        <input type="file" accept="image/png, image/jpeg" class="required validate" id="image">
						      </div>
						      <div class="file-path-wrapper">
						        <input class="file-path validate" type="text" accept="image/png, image/jpeg">
						      </div>
						  </form>
						</div>
                     </div>
                  </div>
                  <div class="step-actions">
                     <button class="waves-effect waves-dark btn next-step">CONTINUE</button>
                     <button class="waves-effect waves-dark btn-flat previous-step">BACK</button>
                  </div>
               </div>
            </li>

            <li class="step">
               <div class="step-title waves-effect waves-dark">Step 3</div>
               <div class="step-content">
                  <div class="row">
                     <div class='form-field col s12'>
                        <p style="font-size: 18px">Description</p>
                        <p style="font-size: 13px">Organizations</p>
                        <div style="line-height: 1.4;font-size: 12px">
	                        <span style="margin-left: 3%; color: red">1) Donâ€™t make assumptions. </span><span>Your best bet is to start from square one and not overly rely on long-term contributors</span><br>
	                        <span style="margin-left: 3%; color: red">2) Host Virtual meetings with your major donors, </span><span>especially hospital benefactors (e.g. family funds) or equipment suppliers</span><br>
	                        
                    	</div>
                    	<p style="font-size: 13px">Individuals</p>
                        <div style="line-height: 1.4;font-size: 12px">
	                        <span style="margin-left: 3%; color: red">1) Make a unique case. </span><span>Millions are suffering from this crisis right now; why is your situation unique, and why should people help?</span><br>
	                        <span style="margin-left: 3%; color: red">2) Ask for what you need. </span><span>Everyone is going through a tough time right now; tell them what you need upfront so they can make informed decisions about the size of their donations</span><br>
                    	</div>
                        <div class="input-field col s12">
                           <input type="text" name="textfield" class="required validate" id="description"/>
                           <label for="textfield">a unique description to your cause</label>
                        </div>
                     </div>
                  </div>
                  <div class="step-actions">
                     <button class="waves-effect waves-dark btn next-step">CONTINUE</button>
                     <button class="waves-effect waves-dark btn-flat previous-step">BACK</button>
                  </div>
               </div>
            </li>

            <li class="step">
               <div class="step-title waves-effect waves-dark">Submit</div>
               <div class="step-content">
                  <div class="row">
                     <div class='form-field'>
                        <p>All done!</p>
                     </div>
                  </div>
                  <div class="step-actions">
                     <a class="waves-effect waves-dark btn" onclick="submitall()"/>Submit</a>
                     <button class="waves-effect waves-dark btn-flat previous-step">BACK</button>
                  </div>
               </div>
            </li>

         </ul>
      </form>
   </div>
   <img id = "temp"></img>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
   <script>
   		var firebaseConfig = {
                piKey: "AIzaSyCcw96huCdBfDqlxOADqtJbPtQbOlAwquA",
			    authDomain: "unit3project.firebaseapp.com",
			    databaseURL: "https://unit3project.firebaseio.com",
			    projectId: "unit3project",
			    storageBucket: "unit3project.appspot.com",
			    messagingSenderId: "420038856149",
			    appId: "1:420038856149:web:230f6e4196b949fa29815c",
			    measurementId: "G-TJ980KD3NZ"
            };
            firebase.initializeApp(firebaseConfig);

            var imagebutton = document.getElementById("image");
	   		imagebutton.addEventListener('change', function(e){
	   			var stor = e.target.files[0];
	   			var storageRef = firebase.storage().ref('images/'+stor.name);
	            var task = storageRef.put(stor);
	   		});

	   		/*
	   		var storageRef = firebase.storage().ref('images/');
	   		storageRef.child('4.png').getDownloadURL().then(function(url) {
			  var xhr = new XMLHttpRequest();
			  xhr.responseType = 'blob';
			  xhr.onload = function(event) {
			    var blob = xhr.response;
			  };
			  xhr.open('GET', url);
			  xhr.send();

			  var imgat = document.getElementById('temp');
  			  imgat.src = url;
  			  console.log(imgat.innerHTML);
			}).catch(function(error) {
			});
			*/


	   		function submitall(){
		   		M.toast({html: 'submitted!'});
		   		
		   		var titleval = document.getElementById("title").value;
		   		var locationval = document.getElementById("location").value;
		   		var linkval = document.getElementById("link").value;
		   		var imgval = document.getElementById("image").value.replace(/^.*[\\\/]/, '');
		   		var descriptionval = document.getElementById("description").value;
		   		var lat = 1.1111;
		   		var lng = 1.1111;

		   		var getlatlong = new XMLHttpRequest();
				getlatlong.onreadystatechange = function() {
				  if (this.readyState == 4 && this.status == 200) {
				    var jsonstor = JSON.parse(this.responseText);
				    var temp = jsonstor['results']['0']['locations']['0']['latLng'];

				    lat = temp['lat'];
				    lng = temp['lng'];
					var firstid = firebase.database().ref('fundraiser').push({
		                title: titleval,
		                location: locationval,
		                link: linkval,
		                image: imgval,
		                description: descriptionval,
		                latitude: lat,
		                longitude: lng
		            }).catch(function(error) {
		                alert("Fundraiser could not be sent" + error);
		            });
				  }
			};
			getlatlong.open("GET", "https://open.mapquestapi.com/geocoding/v1/address?key=h020xslJgKrK3ywDJHnDg6Zs7gQWiVWP&location="+locationval, true);
			getlatlong.send();
	   }

		$(document).ready(function() {
		    $('.stepper').activateStepper();
		})

		/* Materializecss Stepper - By Kinark 2016
		// https://github.com/Kinark/Materialize-stepper
		// JS v2.1.3
		*/

		var validation = $.isFunction($.fn.valid) ? 1 : 0;

		$.fn.isValid = function() {
		    if (validation) {
		        return this.valid();
		    } else {
		        return true;
		    }
		};

		if (validation) {
		    $.validator.setDefaults({
		        errorClass: 'invalid',
		        validClass: "valid",
		        errorPlacement: function(error, element) {
		            if (element.is(':radio') || element.is(':checkbox')) {
		                error.insertBefore($(element).parent());
		            } else {
		                error.insertAfter(element); // default error placement.
		                // element.closest('label').data('error', error);
		                // element.next().attr('data-error', error);
		            }
		        },
		        success: function(element) {
		            if (!$(element).closest('li').find('label.invalid:not(:empty)').length) {
		                $(element).closest('li').removeClass('wrong');
		            }
		        }
		    });

		    // When parallel stepper is defined we need to consider invisible and
		    // hidden fields
		    if ($('.stepper.parallel').length) $.validator.setDefaults({
		        ignore: ''
		    });
		}

		$.fn.getActiveStep = function() {
		    var active = this.find('.step.active');
		    return $(this.children('.step:visible')).index($(active)) + 1;
		};

		$.fn.activateStep = function(callback) {
		    if ($(this).hasClass('step')) return;
		    var stepper = $(this).closest('ul.stepper');
		    stepper.find('>li').removeAttr("data-last");
		    if (window.innerWidth < 993 || !stepper.hasClass('horizontal')) {
		        $(this).addClass("step").stop().slideDown(400, function() {
		            $(this).css({
		                'height': 'auto',
		                'margin-bottom': '',
		                'display': 'inherit'
		            });
		            if (callback) callback();
		            stepper.find('>li.step').last().attr('data-last', 'true');
		        });
		    } else {
		        $(this).addClass("step").stop().css({
		            'width': '0%',
		            'display': 'inherit'
		        }).animate({
		            width: '100%'
		        }, 400, function() {
		            $(this).css({
		                'height': 'auto',
		                'margin-bottom': '',
		                'display': 'inherit'
		            });
		            if (callback) callback();
		            stepper.find('>li.step').last().attr('data-last', 'true');
		        });
		    }
		};

		$.fn.deactivateStep = function(callback) {
		    if (!$(this).hasClass('step')) return;
		    var stepper = $(this).closest('ul.stepper');
		    stepper.find('>li').removeAttr("data-last");
		    if (window.innerWidth < 993 || !stepper.hasClass('horizontal')) {
		        $(this).stop().css({
		            'transition': 'none',
		            '-webkit-transition': 'margin-bottom none'
		        }).slideUp(400, function() {
		            $(this).removeClass("step").css({
		                'height': 'auto',
		                'margin-bottom': '',
		                'transition': 'margin-bottom .4s',
		                '-webkit-transition': 'margin-bottom .4s'
		            });
		            if (callback) callback();
		            stepper.find('>li').removeAttr("data-last");
		            stepper.find('>li.step').last().attr('data-last', 'true');
		        });
		    } else {
		        $(this).stop().animate({
		            width: '0%'
		        }, 400, function() {
		            $(this).removeClass("step").hide().css({
		                'height': 'auto',
		                'margin-bottom': '',
		                'display': 'none',
		                'width': ''
		            });
		            if (callback) callback();
		            stepper.find('>li.step').last().attr('data-last', 'true');
		        });
		    }
		};

		$.fn.showError = function(error) {
		    if (validation) {
		        var name = this.attr('name');
		        var form = this.closest('form');
		        var obj = {};
		        obj[name] = error;
		        form.validate().showErrors(obj);
		        this.closest('li').addClass('wrong');
		    } else {
		        this.removeClass('valid').addClass('invalid');
		        this.next().attr('data-error', error);
		    }
		};

		$.fn.activateFeedback = function() {
		    var active = this.find('.step.active:not(.feedbacking)').addClass('feedbacking').find('.step-content');
		    active.prepend('<div class="wait-feedback"> <div class="preloader-wrapper active"> <div class="spinner-layer spinner-blue"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div><div class="spinner-layer spinner-red"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div><div class="spinner-layer spinner-yellow"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div><div class="spinner-layer spinner-green"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div></div></div>');
		};

		$.fn.destroyFeedback = function() {
		    var active = this.find('.step.active.feedbacking');
		    if (active) {
		        active.removeClass('feedbacking');
		        active.find('.wait-feedback').remove();
		    }
		    return true;
		};

		$.fn.resetStepper = function(step) {
		    if (!step) step = 1;
		    var form = $(this).closest('form');
		    $(form)[0].reset();
		    Materialize.updateTextFields();
		    return $(this).openStep(step);
		};

		$.fn.submitStepper = function(step) {
		    var form = this.closest('form');
		    if (form.isValid()) {
		        form.submit();
		    }
		};

		$.fn.nextStep = function(callback, activefb, e) {
		    var stepper = this;
		    var settings = $(stepper).data('settings');
		    var form = this.closest('form');
		    var active = this.find('.step.active');
		    var next = $(this.children('.step:visible')).index($(active)) + 2;
		    var feedback = active.find('.next-step').length > 1 ? (e ? $(e.target).data("feedback") : undefined) : active.find('.next-step').data("feedback");
		    // If the stepper is parallel, we want to validate the input of the current active step. Not all elements.
		    if ((settings.parallel && $(active).validateStep()) || (!settings.parallel && form.isValid())) {
		        if (feedback && activefb) {
		            if (settings.showFeedbackLoader) stepper.activateFeedback();
		            return window[feedback].call();
		        }
		        active.removeClass('wrong').addClass('done');
		        this.openStep(next, callback);
		        return this.trigger('nextstep');
		    } else {
		        return active.removeClass('done').addClass('wrong');
		    }
		};

		$.fn.prevStep = function(callback) {
		    var active = this.find('.step.active');
		    if (active.hasClass('feedbacking')) return;
		    var prev = $(this.children('.step:visible')).index($(active));
		    active.removeClass('wrong');
		    this.openStep(prev, callback);
		    return this.trigger('prevstep');
		};

		$.fn.openStep = function(step, callback) {
		    var settings = $(this).closest('ul.stepper').data('settings');
		    var $this = this;
		    var step_num = step - 1;
		    step = this.find('.step:visible:eq(' + step_num + ')');
		    if (step.hasClass('active')) return;
		    var active = this.find('.step.active');
		    var next;
		    var prev_active = next = $(this.children('.step:visible')).index($(active));
		    var order = step_num > prev_active ? 1 : 0;
		    if (active.hasClass('feedbacking')) $this.destroyFeedback();
		    active.closeAction(order);
		    step.openAction(order, function() {
		        if (settings.autoFocusInput) step.find('input:enabled:visible:first').focus();
		        $this.trigger('stepchange').trigger('step' + (step_num + 1));
		        if (step.data('event')) $this.trigger(step.data('event'));
		        if (callback) callback();
		    });
		};

		$.fn.closeAction = function(order, callback) {
		    var closable = this.removeClass('active').find('.step-content');
		    if (window.innerWidth < 993 || !this.closest('ul').hasClass('horizontal')) {
		        closable.stop().slideUp(300, "easeOutQuad", callback);
		    } else {
		        if (order == 1) {
		            closable.animate({
		                left: '-100%'
		            }, function() {
		                closable.css({
		                    display: 'none',
		                    left: '0%'
		                }, callback);
		            });
		        } else {
		            closable.animate({
		                left: '100%'
		            }, function() {
		                closable.css({
		                    display: 'none',
		                    left: '0%'
		                }, callback);
		            });
		        }
		    }
		};

		$.fn.openAction = function(order, callback) {
		    var openable = this.removeClass('done').addClass('active').find('.step-content');
		    if (window.innerWidth < 993 || !this.closest('ul').hasClass('horizontal')) {
		        openable.slideDown(300, "easeOutQuad", callback);
		    } else {
		        if (order == 1) {
		            openable.css({
		                left: '100%',
		                display: 'block'
		            }).animate({
		                left: '0%'
		            }, callback);
		        } else {
		            openable.css({
		                left: '-100%',
		                display: 'block'
		            }).animate({
		                left: '0%'
		            }, callback);
		        }
		    }
		};

		$.fn.activateStepper = function(options) {
		    var settings = $.extend({
		        linearStepsNavigation: true,
		        autoFocusInput: true,
		        showFeedbackLoader: true,
		        autoFormCreation: true,
		        parallel: false // By default we don't assume the stepper is parallel
		    }, options);
		    $(document).on('click', function(e) {
		        if (!$(e.target).parents(".stepper").length) {
		            $('.stepper.focused').removeClass('focused');
		        }
		    });

		    $(this).each(function() {
		        var $stepper = $(this);
		        if (!$stepper.parents("form").length && settings.autoFormCreation) {
		            var method = $stepper.data('method');
		            var action = $stepper.data('action');
		            var method = (method ? method : "GET");
		            action = (action ? action : "?");
		            $stepper.wrap('<form action="' + action + '" method="' + method + '"></form>');
		        }

		        $stepper.data('settings', {
		            linearStepsNavigation: settings.linearStepsNavigation,
		            autoFocusInput: settings.autoFocusInput,
		            showFeedbackLoader: settings.showFeedbackLoader,
		            parallel: $stepper.hasClass('parallel')
		        });
		        $stepper.find('li.step.active').openAction(1);
		        $stepper.find('>li').removeAttr("data-last");
		        $stepper.find('>li.step').last().attr('data-last', 'true');

		        $stepper.on("click", '.step:not(.active)', function() {
		            var object = $($stepper.children('.step:visible')).index($(this));
		            if ($stepper.data('settings').parallel && validation) { // Invoke parallel stepper behaviour
		                $(this).addClass('temp-active');
		                $stepper.validatePreviousSteps()
		                $stepper.openStep(object + 1);
		                $(this).removeClass('temp-active');
		            } else if (!$stepper.hasClass('linear')) {
		                $stepper.openStep(object + 1);
		            } else if (settings.linearStepsNavigation) {
		                var active = $stepper.find('.step.active');
		                if ($($stepper.children('.step:visible')).index($(active)) + 1 == object) {
		                    $stepper.nextStep(undefined, true, undefined);
		                } else if ($($stepper.children('.step:visible')).index($(active)) - 1 == object) {
		                    $stepper.prevStep(undefined);
		                }
		            }
		        }).on("click", '.next-step', function(e) {
		            e.preventDefault();
		            $stepper.nextStep(undefined, true, e);
		        }).on("click", '.previous-step', function(e) {
		            e.preventDefault();
		            $stepper.prevStep(undefined);
		        }).on("click", "button:submit:not(.next-step, .previous-step)", function(e) {
		            e.preventDefault();
		            feedback = e ? $(e.target).data("feedback") : undefined;
		            var form = $stepper.closest('form');
		            if (form.isValid()) {
		                if (feedback) {
		                    stepper.activateFeedback();
		                    return window[feedback].call();
		                }
		                form.submit();
		            }
		        }).on("click", function() {
		            $('.stepper.focused').removeClass('focused');
		            $(this).addClass('focused');
		        });
		    });
		};

		/**
		 * Return the step element on given index.
		 *
		 * @param step, index of the step to be returned
		 * @returns {*}, the step requested
		 */
		$.fn.getStep = function(step) {
		    var settings = $(this).closest('ul.stepper').data('settings');
		    var $this = this;
		    var step_num = step - 1;
		    step = this.find('.step:visible:eq(' + step_num + ')');
		    return step;
		};

		/**
		 * Run validation over all previous steps from the steps this
		 * function is called on.
		 */
		$.fn.validatePreviousSteps = function() {
		    var active = $(this).find('.step.temp-active');
		    var index = $(this.children('.step')).index($(active));
		    // We assume that the validator is set to ignore nothing.
		    $(this.children('.step')).each(function(i) {
		        if (i >= index) {
		            $(this).removeClass('wrong done');
		        } else {
		            $(this).validateStep();
		        }
		    });
		};

		/**
		 * Validate the step that this function is called on.
		 */
		$.fn.validateStep = function() {
		    var stepper = this.closest('ul.stepper');
		    var form = this.closest('form');
		    var step = $(this);
		    // Retrieve the custom validator for that step if exists.
		    var validator = step.find('.next-step').data("validator");
		    if (this.validateStepInput()) { // If initial base validation succeeded go on
		        if (validator) { // If a custom validator is given also call that validator
		            if (window[validator].call()) {
		                step.removeClass('wrong').addClass('done');
		                return true;
		            } else {
		                step.removeClass('done').addClass('wrong');
		                return false;
		            }
		        }
		        step.removeClass('wrong').addClass('done');
		        return true;
		    } else {
		        step.removeClass('done').addClass('wrong');
		        return false;
		    }
		};

		/**
		 * Uses the validation variable set by the stepper constructor
		 * to run standard validation on the current step.
		 * @returns {boolean}
		 */
		$.fn.validateStepInput = function() {
		    var valid = true;
		    if (validation) {
		        // Find all input fields dat need validation in current step.
		        $(this).find('input.validate').each(function() {
		            if (!$(this).valid()) {
		                valid = false;
		                return false;
		            }
		        });
		    }
		    return valid;
		};
   </script>
</body>
</html>
